<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>Instance Profile</title>
  <style type="text/css">
    body {
      padding: 0.5em 1em;

      font-family: 'Helvetica Neue', Helvetica, sans-serif;
    }

    pre {
      font-family: 'InputMono', 'Consolas', monospace;
    }

  </style>
  <link type="text/css" rel="stylesheet" href="entity-table.css" />
  <script type="text/javascript" src="dom-helper.js"></script>
  <script type="text/javascript">
    const store = {};

    function renderCustomers(customers) {
      return customers.map((customer, index) => tr(
        td({ dataset: { parent: 'customer.id' }, className: 'atomic' }, customer.id),
        td({ dataset: { parent: 'customer.name.first' }, className: 'atomic' }, customer.name.first),
        td({ dataset: { parent: 'customer.name.last' }, className: 'atomic', className: 'atomic' }, customer.name.last),
        td({ dataset: { parent: 'customer.address.street' } }, customer.address.street),
        td({ dataset: { parent: 'customer.address.city' }, className: 'atomic' }, customer.address.city),
        td({ dataset: { parent: 'customer.address.zip' }, className: 'atomic' }, customer.address.zip),
        td({ dataset: { parent: 'customer.notes' } }, attr('colspan', 2), renderNotes(customer.notes)),
        td({ dataset: { parent: 'customer.verified' }, className: 'atomic' }, String(customer.verified))));
    }

    function renderNotes(notes) {
      return table(
        { className: 'entity', },
        // notes.length ? thead(tr(th('timestamp'), th('text'))) : undefined,
        tbody(notes.map(note => tr(td(note.timestamp, { className: 'atomic' }), td(note.text, { className: 'atomic' })))),
      );
    }

    document.addEventListener('DOMContentLoaded', (evt) => {
      fetch('customers.json')
        .then(response => {
          if (200 === response.status) {
            return response.json()
          } else {
            throw new Error('Did you generate the fake customers with npm run generate?');
          }
        }
        )
        .then(customers => replaceChildren(document.querySelector('tbody'),
          renderCustomers(customers))
        ).catch(error => console.error(error));
      document.querySelector('table').addEventListener('click', evt => console.log(evt.target));
    });
  </script>
</head>

<body>
  <h1>Customer</h1>
  <p class="description">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Mauris ac quam tempus, finibus velit sed, lacinia leo. Morbi id commodo risus, sed fermentum tellus. Nam sit amet condimentum nisi. Nullam et sem et lorem pulvinar blandit. Quisque et sodales odio. Quisque non pretium diam, quis interdum libero. Integer tortor nisl, elementum in molestie et, ultricies vitae libero. </p>
  <ul>
    <li>Mixed content</li>
    <li>Data types</li>
    <li>Arrays and multiplicity: Can we assume that the order of children doesnâ€™t matter, as with JSON?</li>
  </ul>
  <table class="entity xml">
    <thead>
      <tr data-level="0">
        <th colspan="9">customer</th>
      </tr>
      <tr data-level="1">
        <th colspan="1" rowspan="2" id="customer.@id" data-parent="customer">@id</th>
        <th colspan="2" id="customer.name" data-parent="customer">name</th>
        <th colspan="3" id="customer.address" data-parent="customer">address</th>
        <th colspan="2" rowspan="1" id="customer.notes" data-parent="customer">notes</th>
        <th colspan="1" rowspan="2" id="customer.verified" data-parent="customer">verified</th>
      </tr>
      <tr data-level="2">
        <th id="customer.name.first" data-parent="customer.name">first</th>
        <th id="customer.name.family" data-parent="customer.name">family</th>
        <th id="customer.name.street" data-parent="customer.address">street</th>
        <th id="customer.address.city" data-parent="customer.address">city</th>
        <th id="customer.address.zip" data-parent="customer.address">zip</th>
        <th id="customer.notes.timestamp" data-parent="customer.notes">timestamp</th>
        <th id="customer.notes.text" data-parent="customer.notes">text</th>
      </tr>
    </thead>
    <tbody>
      <!--
      <tr>
        <td data-parent="customer.name.@id">148b434b-f4fc-4d91-896f-9e72c0a2d83e</td>
        <td data-parent="customer.name.first">Sam</td>
        <td data-parent="customer.name.family">McDaniel</td>
        <td data-parent="customer.address.city">Pittsburgh</td>
        <td data-parent="customer.address.street">33 Main Street</td>
        <td data-parent="customer.address.zip">15204</td>
        <td data-parent="customer.address.verified">true</td>
      </tr>
      -->
    </tbody>
  </table>
  <pre>
&lt;customer id="148b434b-f4fc-4d91-896f-9e72c0a2d83e"&gt;
  &lt;name&gt;
    &lt;first&gt;Sam&lt;/first&gt;
    &lt;family&gt;McDaniel&lt;/family&gt;
  &lt;/name&gt;
  &lt;address&gt;
    &lt;street&gt;33 Main Street&lt;/street&gt;
    &lt;city&gt;Pittsburgh&lt;/city&gt;
    &lt;zip&gt;15204&lt;/zip&gt;
  &lt;/address&gt;
  &lt;verified&gt;true&lt;/verified&gt;
&lt;/customer&gt;
  </pre>
</body>

</html>
