<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>Table</title>
  <link rel="stylesheet" type="text/css" href="" />
  <script type="application/javascript" src=""></script>
  <style type="text/css">
    body {
      padding: 0.5em 1em;
      font-family: 'Helvetica Neue', 'Helvetica', sans-serif;
      font-size: 10pt;
    }

    pre {
      font-family: 'InputMono', 'Consolas', monospace;
    }

  </style>
  <style type="text/css">
    table {
      width: 100%;
      font-family: 'InputMono', 'Consolas', monospace;
      border-collapse: collapse;
      margin: 0;
    }

    tbody tr:first-child td {
      border-top: solid 1px #333;
    }

    tbody:nth-child(2n+1) {
      background: #f1f1f1;
    }

    tbody:hover td {
      background: palegoldenrod;
    }

    th,
    td {
      border: solid 0.5px #999;
      padding: 0.5em 0.5em;
      vertical-align: top;
      text-align: left;
    }

    td.blank {}

  </style>
  <script type="text/javascript">
    const doc = {
      a: "A", /* 1 */
      b: "B", /* 1 */
      c: [
        "C0" /* 1 */, "C1", /* 2 */ "C2" /* 3 */
      ],
      d: [
        { e: "E0", f: "F0" }, /* 1 */
        { e: "E1", f: "F1" }, /* 2 */
        { e: "E2", f: "F2", x: [1, 2, 3] }, /* 3 */
        { e: "E3", f: "F3" }  /* 4 */
      ],
      g: { h: { i: "I", j: "J" } } /* 1 */
    };

    // ["A", "B", ["C0", "C1", "C2"], [{e: "E0", f: "F0"}, {e: "E1", f: "F1"}, {e: "E2", f: "F2"}, {e: "E3", f: "F3"}], "I", "J"]

    /*
    ["A", "B", [["C0"], 
                ["C1"], 
                ["C2"]], [["E0", "F0"], 
                          ["E1", "F1"], 
                          ["E2", "F2"], 
                          ["E3", "F3"]], "I", "J"]
    */

    function traverse(obj, accumulator = []) {
      if (isPrimitiveOrNull(obj)) {
        accumulator.push(obj);
      } else if (Array.isArray(obj)) {
        accumulator.push(obj.map(item => traverse(item, [])));
      } else {
        for (const prop of Object.getOwnPropertyNames(obj)) {
          const item = obj[prop];
          traverse(item, accumulator);
        }
      }
      return accumulator;
    }

    function tablify1(flat) {
      let depth = 0;
      const rows = [];
      let counter = 0;
      let current = flat;
      let rest = [];
      do {
        rows[depth] = [];
        let col = 0;
        for (let c = 0; c < current.length; c++) {
          const item = current[c];
          if (Array.isArray(item)) {
            const newItems = item.shift();
            if (item.length > 0) {
              rows[depth] = rows[depth].concat(newItems);
              rest.push(item);
              col += newItems.length;
            }
          } else {
            rows[depth][col] = item;
            col++;
          }
        }
        console.log(JSON.stringify(rows[depth]));
        console.log(JSON.stringify(rest));
        console.log("----------------------");
        current = rest;
        depth++;
      } while (rest.length > 0 && counter++ < 10);
      return rows;
    }

    function tablify(flat) {
      const rows = [], rest = [];
      let current = flat;
      let depth = -1;

      do {
        depth++;
        let index = 0;
        rows[depth] = [];
        for (let c = 0; c < current.length; c++) {
          const item = current[c];
          if (Array.isArray(item)) {
            const first = item.shift();
            rows[depth] = rows[depth].concat(first);
            if (item.length > 0) {
              rest.push(item);
            }
            index += first.length;
          } else {
            rows[depth][index] = item;
            index++;
          }
        }
        current = Array.from(rest);
      } while (rest.length > 0)
      return rows;
    }

    console.log(JSON.stringify(traverse(doc)));
    console.log(tablify(traverse(doc)));

    /*
        function traverse(obj) {
          let level = 0, col = 0;
          const next = [];
          const rows = [];
    
          function walk(obj) {
            for (const prop of Object.getOwnPropertyNames(obj)) {
              const item = obj[prop];
              if (isPrimitiveOrNull(item)) {
                rows[level][col++] = item;
              } else if (Array.isArray(item)) {
                if (level < item.length - 1) {
                  rows[level][col++] = item[]
                  next.push(item);
                }
              }
            }
          }
    
        }
    */
    function isPrimitiveOrNull(value) {
      if (null === value) return true;
      switch (typeof value) {
        case 'undefined':
        case 'string':
        case 'number':
        case 'boolean':
        case 'symbol':
        case 'function':
          return true;
        case 'object':
          return value instanceof Date;
      }
      return false;
    }
    function isNullOrUndefined(value) {
      return 'undefined' === typeof value || null === value;
    }
    function isObject(value) {
      return !isPrimitiveOrNull(value) && 'object' === typeof value;
    }
    document.addEventListener('DOMContentLoaded', evt => {
      const table = document.querySelector('#dyn');

    });
  </script>
</head>

<body>
  <h2>Input Documents</h2>
  <p>The outer array holds a collection of entity instances. We can intially assume that the instances share a common structure. </p>
  <pre>
    [
      {
        a: "A",
        b: "B",
        c: [
          "C0"
        ],
        d: [
          { e: "E0", f: "F0" }, 
          { e: "E1", f: "F1" }, 
          { e: "E2", f: "F2" }, 
          { e: "E3", f: "F3" }  
        ],
        g: { h: { i: "I", j: "J" } } 
      },
      {
        a: "A",
        b: "B",
        c: [
          "C0"
        ],
        d: [
          { e: "E0", f: "F0" }, 
          { e: "E1", f: "F1" }, 
          { e: "E2", f: "F2" }, 
          { e: "E3", f: "F3" }  
        ],
        g: { h: { i: "I", j: "J" } } 
      },
      {
        a: "A",
        b: "B",
        c: [
          "C0"
        ],
        d: [
          { e: "E0", f: "F0" }, 
          { e: "E1", f: "F1" }, 
          { e: "E2", f: "F2" }, 
          { e: "E3", f: "F3" }  
        ],
        g: { h: { i: "I", j: "J" } } 
      }
    ]
      </pre>
  <h2>Output Table</h2>
  <table id="static">
    <thead>
      <tr>
        <th rowspan="4">a</th>
        <th rowspan="4">b</th>
        <th rowspan="4">c</th>
        <th colspan="2">d</th>
        <th colspan="2">g</th>
      </tr>
      <tr>
        <th rowspan="3">e</th>
        <th rowspan="3">f</th>
      </tr>
      <tr>
        <th colspan="2">h</th>
      </tr>
      <tr>
        <th>i</th>
        <th>j</th>
      </tr>
    </thead>
    <tbody data-rownum="1">
      <tr>
        <td rowspan="4">A</td>
        <td rowspan="4">B</td>
        <td>C0</td>
        <td>E0</td>
        <td>F0</td>
        <td rowspan="4">I</td>
        <td rowspan="4">J</td>
      </tr>
      <tr>
        <td>C1</td>
        <td>E1</td>
        <td>F1</td>
      </tr>
      <tr>
        <td>C2</td>
        <td>E2</td>
        <td>F2</td>
      </tr>
      <tr>
        <td class="blank"></td>
        <td>E3</td>
        <td>E4</td>
      </tr>
    </tbody>
    <tbody data-rownum="2">
      <tr>
        <td rowspan="4">A</td>
        <td rowspan="4">B</td>
        <td>C0</td>
        <td>E0</td>
        <td>F0</td>
        <td rowspan="4">I</td>
        <td rowspan="4">J</td>
      </tr>
      <tr>
        <td>C1</td>
        <td>E1</td>
        <td>F1</td>
      </tr>
      <tr>
        <td>C2</td>
        <td>E2</td>
        <td>F2</td>
      </tr>
      <tr>
        <td class="blank"></td>
        <td>E3</td>
        <td>E4</td>
      </tr>
    </tbody>
    <tbody data-rownum="3">
      <tr>
        <td rowspan="4">A</td>
        <td rowspan="4">B</td>
        <td>C0</td>
        <td>E0</td>
        <td>F0</td>
        <td rowspan="4">I</td>
        <td rowspan="4">J</td>
      </tr>
      <tr>
        <td>C1</td>
        <td>E1</td>
        <td>F1</td>
      </tr>
      <tr>
        <td>C2</td>
        <td>E2</td>
        <td>F2</td>
      </tr>
      <tr>
        <td class="blank"></td>
        <td>E3</td>
        <td>E4</td>
      </tr>
    </tbody>
  </table>
  <table id="dyn"></table>
</body>

</html>
